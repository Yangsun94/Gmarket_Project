name: Code Quality Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  code-quality:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout ì½”ë“œ
      uses: actions/checkout@v4

    - name: Python ì„¤ì •
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'

    - name: ì½”ë“œ í’ˆì§ˆ ë„êµ¬ ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install flake8 black pylint isort

    - name: ì½”ë“œ í¬ë§· ê²€ì‚¬ (Black)
      run: |
        echo "ì½”ë“œ í¬ë§·íŒ…ì´ ì˜¬ë°”ë¥¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤..."
        echo "ë¡œì»¬ì—ì„œ 'black framework/ tests/ --line-length=120'ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”"
        black --check framework/ tests/ --line-length=120 --diff

    - name: Import ì •ë ¬ ê²€ì‚¬ (isort)
      run: |
        echo "Import ì •ë ¬ì´ ì˜¬ë°”ë¥¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤..."
        echo "ë¡œì»¬ì—ì„œ 'isort framework/ tests/ --profile black'ì„ ì‹¤í–‰í•˜ì„¸ìš”"
        isort --check-only framework/ tests/ --profile black --diff

    - name: ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬ (Flake8)
      run: |
        echo "PEP 8 ìŠ¤íƒ€ì¼ ê°€ì´ë“œë¥¼ ë”°ë¥´ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤..."
        flake8 framework/ tests/ --max-line-length=120 --extend-ignore=E203,W503,E501 --statistics
      continue-on-error: true

    - name: ì½”ë“œ í’ˆì§ˆ ë¶„ì„ (Pylint)
      run: |
        echo "ì½”ë“œ í’ˆì§ˆì„ ë¶„ì„í•©ë‹ˆë‹¤ (ëª©í‘œ: 7.0/10.0 ì´ìƒ)..."
        pylint framework/ --fail-under=7.0 --max-line-length=120 || echo "Pylint ì ìˆ˜ê°€ 7.0 ë¯¸ë§Œì…ë‹ˆë‹¤"
      continue-on-error: true

    - name: í’ˆì§ˆ ê²€ì‚¬ ìš”ì•½
      if: always()
      run: |
        echo "ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"
        echo ""
        echo "ë¡œì»¬ì—ì„œ ìë™ ìˆ˜ì • ë°©ë²•:"
        echo "  black framework/ tests/ --line-length=120"
        echo "  isort framework/ tests/ --profile black"
        echo ""
        echo "Pre-commit Hook ì„¤ì¹˜:"
        echo "  pip install pre-commit"
        echo "  pre-commit install"

  security-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout ì½”ë“œ
      uses: actions/checkout@v4

    - name: Python ì„¤ì •
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬ (Safety)
      run: |
        echo "ì•Œë ¤ì§„ ë³´ì•ˆ ì·¨ì•½ì ì„ ê²€ì‚¬í•©ë‹ˆë‹¤..."
        pip install safety
        pip install -r requirements.txt
        safety check --json || echo "ë³´ì•ˆ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤"
      continue-on-error: true

    - name: ë³´ì•ˆ ê²€ì‚¬ ìš”ì•½
      if: always()
      run: |
        echo "âœ… ë³´ì•ˆ ê²€ì‚¬ ì™„ë£Œ"
        echo ""
        echo "ğŸ’¡ ì·¨ì•½ì ì´ ë°œê²¬ëœ ê²½ìš°:"
        echo "  pip install --upgrade [íŒ¨í‚¤ì§€ëª…]"